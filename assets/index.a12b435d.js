import{c as e,o as t,a as r,b as s,r as n,w as i,v as a,d as c,F as l,e as o,f as d,g as h,t as u,l as p,n as g,h as m,i as f,j as y,k,m as b}from"./vendor.a499bd19.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();let x=null;const w=new Map,v=new WebSocket("wss://streamer.cryptocompare.com/v2?api_key=95bdf7e8c4ef1827e5f4b13d319b2ac9b409aa62feedc30f0f6553924d6ab246"),C="subscribe",T="unsubscribe",S="update",E=new SharedWorker("/worker.js");function M(e,t,r="USD"){const s=w.get(e)||[];w.set(e,[...s,t]),L({action:"SubAdd",subs:[`5~CCCAGG~${e}~${r}`]}),E.port.postMessage({type:"subscribe",fsym:e,tsym:r})}function G(e,t){if(!t&&"BTC"!==e)return L({action:"SubRemove",subs:[`5~CCCAGG~${e}~USD`]}),L({action:"SubRemove",subs:[`5~CCCAGG~${e}~BTC`]}),w.delete(e),E.port.postMessage({type:"unsubscribe",fsym:e,tsym:"USD"}),void E.port.postMessage({type:"unsubscribe",fsym:e,tsym:"BTC"});w.set(e,w.get(e).filter((e=>e!==t)))}function L(e){const t=v.send.bind(v,JSON.stringify(e));v.readyState!==WebSocket.OPEN?v.addEventListener("open",t):t()}E.port.start(),v.addEventListener("message",(e=>{const t=JSON.parse(e.data);"20"!==t.TYPE?"429"===t.TYPE&&E.port.addEventListener("message",(({data:{data:e,type:t}})=>{if(t===S){const{fsym:t,price:r,tsym:s}=e;(w.get(t)||[]).forEach((e=>e({name:t,price:r,tsym:s})))}})):E.port.addEventListener("message",(({data:{type:e,fsym:t,tsym:r}})=>{e!==C?e===T&&L({action:"SubRemove",subs:[`5~CCCAGG~${t}~${r}`]}):L({action:"SubAdd",subs:[`5~CCCAGG~${t}~${r}`]})}))})),v.addEventListener("message",(e=>{const t=JSON.parse(e.data),{TYPE:r,MESSAGE:s,INFO:n}=t;if("500"===r&&"INVALID_SUB"===s){const e=t.PARAMETER.split("~")[2];if("USD"===function(e){return e.split("~")[3]}(t.PARAMETER)){const t=w.get(e)||[];return w.delete(e),void t.forEach((t=>M(e,(({name:e,error:r,price:s,message:n})=>{t({name:e,error:r,price:x*s,message:n})}),"BTC")))}const r=w.get(e);return r?void r.forEach((t=>t({name:e,error:!0,message:n}))):void G(e)}if("5"===r){const{FROMSYMBOL:e,PRICE:r,TOSYMBOL:s}=t;if(r){E.port.postMessage({type:"update",data:{fsym:e,price:r,tsym:s}});(w.get(e)||[]).forEach((t=>t({name:e,price:r,tsym:s})))}}})),M("BTC",(({price:e})=>{x=e}));const O={},A={type:"button",class:"my-4 inline-flex items-center py-2 px-4 border border-transparent shadow-sm text-sm leading-4 font-medium rounded-full text-white bg-gray-600 hover:bg-gray-700 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"},I=[r("svg",{class:"-ml-0.5 mr-2 h-6 w-6",xmlns:"http://www.w3.org/2000/svg",width:"30",height:"30",viewBox:"0 0 24 24",fill:"#ffffff"},[r("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"})],-1),s(" Добавить ")];O.render=function(r,s){return t(),e("button",A,I)};const $={components:{AddButton:O},props:{getHints:{type:Function,required:!1,default:null},checkTicker:{type:Function,required:!1,default:null}},emits:{"add-ticker":function(e){return"string"==typeof e&&e.length>0}},data:()=>({ticker:""}),methods:{add(){0!==this.ticker.length&&(this.$emit("add-ticker",this.ticker),this.ticker="")},hintClick(e){this.ticker=e,this.add()},handleInput(){this.ticker=this.ticker.toUpperCase()}},computed:{hints(){return this.getHints(this.ticker)},tickerExists(){return this.checkTicker&&this.checkTicker(this.ticker)}}},j={class:"flex"},z={class:"max-w-xs"},N=r("label",{for:"wallet",class:"block text-sm font-medium text-gray-700"},"Тикер",-1),H={class:"mt-1 relative rounded-md shadow-md"},P={key:0,class:"flex bg-white shadow-md p-1 rounded-md flex-wrap"},U=["onClick"],B={key:1,class:"text-sm text-red-600"};$.render=function(s,p,g,m,f,y){const k=n("add-button");return t(),e("section",null,[r("div",j,[r("div",z,[N,r("div",H,[i(r("input",{"onUpdate:modelValue":p[0]||(p[0]=e=>f.ticker=e),onKeydown:p[1]||(p[1]=c(((...e)=>y.add&&y.add(...e)),["enter"])),onInput:p[2]||(p[2]=(...e)=>y.handleInput&&y.handleInput(...e)),type:"text",name:"wallet",id:"wallet",class:"block w-full p-2 mt-2 pr-10 border-gray-300 text-gray-900 focus:outline-none focus:ring-gray-500 focus:border-gray-500 sm:text-sm rounded-md",placeholder:"Например DOGE"},null,544),[[a,f.ticker]])]),g.getHints&&f.ticker.length>0?(t(),e("div",P,[(t(!0),e(l,null,o(y.hints,(r=>(t(),e("span",{key:r,class:"inline-flex items-center px-2 m-1 rounded-md text-xs font-medium bg-gray-300 text-gray-800 cursor-pointer",onClick:e=>y.hintClick(r)},u(r),9,U)))),128))])):d("",!0),y.tickerExists?(t(),e("div",B," Такой тикер уже добавлен ")):d("",!0)])]),h(k,{onClick:y.add},null,8,["onClick"])])};const D={props:{graph:{type:Array,reqiured:!0},graphbarWidth:{type:Number,required:!1,default:35},heading:{type:String,required:!1,default:"Graph"}},emits:{"close-click":null},data:()=>({maxGraphLength:1}),mounted(){this.calculateMaxGraphLength(),window.addEventListener("resize",this.calculateMaxGraphLength)},beforeUnmount(){window.removeEventListener("resize",this.calculateMaxGraphLength)},computed:{normalizedGraph(){const e=Math.max(...this.graph),t=Math.min(...this.graph);return t===e?new Array(this.graph.length).fill(50):this.graph.map((r=>5+95*(r-t)/(e-t)))},slicedGraph(){return this.normalizedGraph.slice(-this.maxGraphLength)}},methods:{calculateMaxGraphLength:p.exports.debounce((function(){this.$refs.graph&&(this.maxGraphLength=Math.ceil(this.$refs.graph.clientWidth/this.graphbarWidth))}),150,{leading:!0}),clickHandler(){this.$emit("close-click")}}},R={class:"relative"},V={class:"text-lg leading-6 font-medium text-gray-900 my-8"},F=[r("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:svgjs":"http://svgjs.com/svgjs",version:"1.1",width:"30",height:"30",x:"0",y:"0",viewBox:"0 0 511.76 511.76",style:{"enable-background":"new 0 0 512 512"},"xml:space":"preserve"},[r("g",null,[r("path",{d:"M436.896,74.869c-99.84-99.819-262.208-99.819-362.048,0c-99.797,99.819-99.797,262.229,0,362.048    c49.92,49.899,115.477,74.837,181.035,74.837s131.093-24.939,181.013-74.837C536.715,337.099,536.715,174.688,436.896,74.869z     M361.461,331.317c8.341,8.341,8.341,21.824,0,30.165c-4.16,4.16-9.621,6.251-15.083,6.251c-5.461,0-10.923-2.091-15.083-6.251    l-75.413-75.435l-75.392,75.413c-4.181,4.16-9.643,6.251-15.083,6.251c-5.461,0-10.923-2.091-15.083-6.251    c-8.341-8.341-8.341-21.845,0-30.165l75.392-75.413l-75.413-75.413c-8.341-8.341-8.341-21.845,0-30.165    c8.32-8.341,21.824-8.341,30.165,0l75.413,75.413l75.413-75.413c8.341-8.341,21.824-8.341,30.165,0    c8.341,8.32,8.341,21.824,0,30.165l-75.413,75.413L361.461,331.317z",fill:"#718096","data-original":"#000000"})])],-1)],W={ref:"graph",class:"flex items-end border-gray-600 border-b border-l h-64"};D.render=function(s,n,i,a,c,d){return t(),e("section",R,[r("h3",V,u(i.heading),1),r("button",{onClick:n[0]||(n[0]=(...e)=>d.clickHandler&&d.clickHandler(...e)),type:"button",class:"absolute top-0 right-0"},F),r("div",W,[(t(!0),e(l,null,o(d.slicedGraph,((r,s)=>(t(),e("div",{ref:"graphbar",key:s,style:g({height:`${r}%`,width:`${i.graphbarWidth}px`}),class:"bg-purple-800 border"},null,4)))),128))],512)])};const q={name:"App",components:{AddTicker:$,CryptoGraph:D},async created(){try{let e=await m.get("https://min-api.cryptocompare.com/data/all/coinlist?summary=true",{timeout:5e3});this.cryptoObject=e.data.Data,this.pageStatus=1}catch(s){this.pageStatus=-1,this.errorMessage=s.toString()}let e=window.localStorage.getItem("cryptonomicon-list");this.tickers=JSON.parse(e)||[],this.tickers.forEach((e=>{M(e.name,this.subscribe)})),this.tickers.length>0&&this.select(this.tickers[0]);let{filter:t,page:r}=Object.fromEntries(new URLSearchParams(window.location.search).entries());r&&(this.page=+r),t&&(this.filter=t)},data:()=>({tickers:[],selectedTicker:null,graph:[],filter:"",page:1,errorMessage:null,pageStatus:1,cryptoObject:{}}),computed:{hasNextPage(){return this.filteredTickers.length>this.endIndex},filteredTickers(){return this.tickers.filter((e=>e.name.includes(this.filter.toUpperCase())))},startIndex(){return 6*(this.page-1)},endIndex(){return 6*this.page},paginatedTickers(){return this.filteredTickers.slice(this.startIndex,this.endIndex)},pageStateOptions(){return{filter:this.filter,page:this.page}}},watch:{graph(e){e.length>80&&(this.graph=e.slice(-80))},filter(){this.page=1},pageStateOptions(e){window.history.pushState(null,window.document.title,`${window.location.pathname}?page=${e.page}&filter=${e.filter}`)},selectedTicker(){this.graph=[]},tickers(e){localStorage.setItem("cryptonomicon-list",JSON.stringify(e))},paginatedTickers(e){0==e.length&&this.page>1&&(this.page-=1)}},methods:{getHints(e){return Object.keys(this.cryptoObject).filter((t=>t.includes(e)||this.cryptoObject[t].FullName.toUpperCase().includes(e))).slice(0,4)},tickerExists(e){return!!this.getTicker(e)},subscribe({name:e,price:t,error:r,message:s}){var n;if(r)return console.log({error:r,message:s}),this.getTicker(e).error=s,void(this.tickers=this.tickers.slice());this.getTicker(e).price=t,this.tickers=this.tickers.slice(),(null==(n=this.selectedTicker)?void 0:n.name)===e&&(this.graph=[...this.graph,t])},getTicker(e){return this.tickers.find((t=>t.name===e))},formatPrice:(e=0)=>"number"!=typeof e?e:(e=Number(e))<1?e.toPrecision(3):e.toFixed(2),tickerIsValid(e){return Object.keys(this.cryptoObject).includes(e)},add(e){if(!this.tickerIsValid(e))return;const t={name:e,price:"-"};this.tickers=[...this.tickers,t],this.filter="",M(t.name,this.subscribe)},select(e){this.selectedTicker=e},handleDelete(e){var t;clearInterval(e.intervalID),this.tickers=this.tickers.filter((t=>t.name!==e.name)),e.name===(null==(t=this.selectedTicker)?void 0:t.name)&&(this.selectedTicker=null),G(e.name,this.subscribe)}}},J={class:"bg-gray-100"},Y={class:"container mx-auto flex flex-col items-center p-4"},K={key:0,class:"\n          fixed\n          w-100\n          h-100\n          opacity-80\n          bg-purple-800\n          inset-0\n          z-50\n          flex\n          items-center\n          justify-center\n        "},_=[r("svg",{class:"animate-spin -ml-1 mr-3 h-12 w-12 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)],Q={key:1,class:"\n          fixed\n          w-100\n          h-100\n          opacity-80\n          text-center\n          bg-purple-800\n          inset-0\n          z-50\n          flex flex-col\n          items-center\n          justify-center\n          text-white\n        "},X=r("h1",{class:"text-2xl mx-16 mb-4"}," Coin list fetch failed. Try reloading this page. ",-1),Z={class:"text-base block"},ee={key:2,class:"container"},te=r("hr",{class:"w-full border-t border-gray-600 my-4"},null,-1),re=r("label",null,"Поиск",-1),se={class:"space-x-4 my-4"},ne=r("hr",{class:"w-full border-t border-gray-600 my-4"},null,-1),ie={class:"mt-5 grid grid-cols-1 gap-5 sm:grid-cols-3 items-center"},ae=["onClick"],ce={class:"px-4 py-5 sm:p-6 text-center"},le={class:"text-sm font-medium text-gray-500 truncate"},oe={class:"mt-1 text-3xl font-semibold text-gray-900"},de=r("div",{class:"w-full border-t border-gray-200"},null,-1),he=["onClick"],ue=[r("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"#718096","aria-hidden":"true"},[r("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),s("Удалить ")],pe=r("hr",{class:"w-full border-t border-gray-600 my-4"},null,-1);q.render=function(s,c,p,g,m,b){const x=n("add-ticker"),w=n("crypto-graph");return t(),e("div",J,[r("div",Y,[0===m.pageStatus?(t(),e("div",K,_)):-1===m.pageStatus?(t(),e("div",Q,[X,r("pre",Z,u(m.errorMessage),1)])):(t(),e("div",ee,[h(x,{onAddTicker:b.add,getHints:b.getHints,checkTicker:b.tickerExists},null,8,["onAddTicker","getHints","checkTicker"]),m.tickers.length?(t(),e(l,{key:0},[te,r("div",null,[re,i(r("input",{"onUpdate:modelValue":c[0]||(c[0]=e=>m.filter=e),type:"text",class:"\n                block\n                mt-2\n                relative\n                shadow-md\n                w-52\n                pr-10\n                p-2\n                border-gray-300\n                text-gray-900\n                focus:outline-none\n                focus:ring-gray-500\n                focus:border-gray-500\n                sm:text-sm\n                rounded-md\n              ",placeholder:"например DOGE"},null,512),[[a,m.filter]]),r("div",se,[m.page>1?(t(),e("button",{key:0,class:"\n                  inline-flex\n                  items-center\n                  py-2\n                  px-4\n                  border border-transparent\n                  shadow-sm\n                  text-sm\n                  leading-4\n                  font-medium\n                  rounded-full\n                  text-white\n                  bg-gray-600\n                  hover:bg-gray-700\n                  transition-colors\n                  duration-300\n                  focus:outline-none\n                  focus:ring-2 focus:ring-offset-2 focus:ring-gray-500\n                ",onClick:c[1]||(c[1]=e=>m.page-=1)}," Назад ")):d("",!0),b.hasNextPage?(t(),e("button",{key:1,class:"\n                  inline-flex\n                  items-center\n                  py-2\n                  px-4\n                  border border-transparent\n                  shadow-sm\n                  text-sm\n                  leading-4\n                  font-medium\n                  rounded-full\n                  text-white\n                  bg-gray-600\n                  hover:bg-gray-700\n                  transition-colors\n                  duration-300\n                  focus:outline-none\n                  focus:ring-2 focus:ring-offset-2 focus:ring-gray-500\n                ",onClick:c[2]||(c[2]=e=>m.page+=1)}," Вперед ")):d("",!0)])]),ne,r("dl",ie,[(t(!0),e(l,null,o(b.paginatedTickers,(s=>{var n,i;return t(),e("div",{key:s.name,onClick:e=>b.select(s),class:y(["\n                bg-white\n                overflow-hidden\n                shadow\n                rounded-lg\n                border-purple-800 border-solid\n                cursor-pointer\n              ",{"border-4":(null==(n=m.selectedTicker)?void 0:n.name)===s.name,"my-1":(null==(i=m.selectedTicker)?void 0:i.name)!==s.name,"bg-red-100":s.error}])},[r("div",ce,[r("dt",le,u(s.name)+" - USD ",1),r("dd",oe,u(b.formatPrice(s.price)),1)]),de,r("button",{onClick:k((e=>b.handleDelete(s)),["stop"]),class:"\n                  flex\n                  items-center\n                  justify-center\n                  font-medium\n                  w-full\n                  bg-gray-100\n                  px-4\n                  py-4\n                  sm:px-6\n                  text-md text-gray-500\n                  hover:text-gray-600\n                  hover:bg-gray-200\n                  hover:opacity-20\n                  transition-all\n                  focus:outline-none\n                "},ue,8,he)],10,ae)})),128))]),pe],64)):d("",!0),m.selectedTicker?(t(),f(w,{key:1,graph:m.graph,heading:`${m.selectedTicker.name} - USD`,onCloseClick:c[3]||(c[3]=e=>m.selectedTicker=null)},null,8,["graph","heading"])):d("",!0)]))])])};b(q).mount("#app");
